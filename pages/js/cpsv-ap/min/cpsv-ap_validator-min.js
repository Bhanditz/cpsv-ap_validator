var sparqlEndpoint="cpsv-ap_validator";var homepage="cpsv-ap_validator.html";var serverhost="localhost";var serverport="3000";var servercookiedays=1;var servercookiename="cpsv-ap";var queryfile="cpsv-ap.txt";var samplettlfile="samples/sample-turtle.ttl";var samplerdffile="samples/sample-xml.rdf";var samplentfile="samples/sample-n-triples.nt";var samplejsonldfile="samples/sample-json-ld.jsonld";var editor,editortab1,editortab2,editortab3;var pattern_xml=/^\s*<\?xml/;var pattern_turtle=/^\s*@/;var pattern_json_ld=/^\s*\{/;var pattern_n3=/^\s*<http/;function setCookie(a,b){Cookies.set(servercookiename,a,{expires:b})}function getGraphFromCookie(){return Cookies.get(servercookiename)}function uploadFile(b,c,e){var a,d;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.onreadystatechange=function(){if(a.readyState===4&&a.status!==200){alert(a.status+" "+a.statusText)}};d=new FormData();d.append("graph",c);d.append("file",b);a.open("POST",e+"/upload",false);a.send(d)}function getAndLoadFile(a,c,d){var b;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{b=new ActiveXObject("Microsoft.XMLHTTP")}b.onreadystatechange=function(){if(this.readyState===4&&this.status!==200){alert(a+" was not loaded in the triple store: "+this.readyState+" HTTP"+this.status+" "+this.statusText)}else{if(this.readyState===4&&this.status===200){alert(this.readyState+" HTTP"+this.status+" "+this.statusText+this.responseText);var e=new Blob([this.responseText],{type:"text/xml"});uploadFile(e,c,d)}}};b.responseType="text/xml";b.open("GET",a,true);b.send()}function runUpdateQuery(b,c){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.onreadystatechange=function(){if(a.readyState===4&&a.status!==200){alert(a.status+" "+a.statusText)}};a.open("POST",c+"/update",false);a.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8;");a.send("update="+encodeURIComponent(b))}function deleteGraph(a,b){if(a==="default"){runUpdateQuery("CLEAR DEFAULT",b)}else{runUpdateQuery("CLEAR GRAPH <"+a+">",b)}}function runQuery(d,c){var b,a;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{b=new ActiveXObject("Microsoft.XMLHTTP")}b.onreadystatechange=function(){if(b.readyState===4&&b.status!==200){alert(b.status+" "+b.statusText)}};a=d+"/query?"+encodeURIComponent(c);b.open("GET",a,false);b.send();return b.responseText}function getQuery(b,c){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.onreadystatechange=function(){if(a.readyState===4&&a.status!==200){alert("Error when opening the file: "+b+" - "+a.status+" "+a.statusText)}else{if(a.readyState===4&&a.status===200){var d=a.responseText;d=d.replace("@@@TOKEN-GRAPH@@@",c);editortab1.setValue(d);editortab2.setValue(d);editortab3.setValue(d)}}};a.open("GET",b,true);a.send();return a.responseText}function loadFile(b){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.onreadystatechange=function(){if(a.readyState===4&&a.status!==200){alert("Error when opening the file: "+b+" - "+a.status+" "+a.statusText)}else{if(a.readyState===4&&a.status===200){editor.setValue(a.responseText)}}};a.open("GET",b,true);a.send();return a.responseText}String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1};function validateMetadata(b,c){var a=$(b).get(0).files.length>0;if(a){$(c).text("");return true}if(!a){$(c).text("The RDF file is a required field.");return false}}function validateEndpoint(g,a,c){var d=$(g).val(),e=/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,b=d.length>0,f=e.test(d);if(b&&f){$(a).text("");return true}if(!b){$(a).text("The "+c+" is a required field.");return false}if(!f){$(a).text("The "+c+" is not a valid URL.");return false}}function validateQuery(d,c,b){var a=d.getValue().trim()!=="";if(a){$(c).text("");return true}if(!a){$(c).text("The "+b+" is a required field.");return false}}$("#metadatafile").change(function(){validateMetadata("#metadatafile","#metadatafileerror")});$("#tab1endpoint").focusout(function(){validateEndpoint("#tab1endpoint","#tab1endpointerror","SPAQL endpoint")});$("#address").focusout(function(){validateEndpoint("#address","#addresserror","address of the RDF file")});$("#tab2endpoint").focusout(function(){validateEndpoint("#tab2endpoint","#tab2endpointerror","SPAQL endpoint")});$("#tab3endpoint").focusout(function(){validateEndpoint("#tab3endpoint","#tab3endpointerror","SPAQL endpoint")});function validateForm1(){var a=validateMetadata("#metadatafile","#metadatafileerror"),c=validateEndpoint("#tab1endpoint","#tab1endpointerror","SPAQL endpoint"),b=validateQuery(editortab1,"#editortab1error","SPARQL query");if(a&&c&&b){return true}return false}function validateForm2(){var a=validateEndpoint("#address","#addresserror","address of the RDF file"),c=validateEndpoint("#tab2endpoint","#tab2endpointerror","SPAQL endpoint"),b=validateQuery(editortab2,"#editortab2error","SPARQL query");if(a&&c&&b){return true}return false}function validateForm3(){var a=validateQuery(editor,"#editorerror","direct RDF input"),c=validateEndpoint("#tab3endpoint","#tab3endpointerror","SPAQL endpoint"),b=validateQuery(editortab3,"#editortab3error","SPARQL query");if(a&&c&&b){return true}return false}function filterInput(b){var a=b.replace(/[\u00A0\u1680​\u180e\u2000-\u2009\u200a​\u200b​\u202f\u205f​\u3000]/g,"");return a}function getBaseURL(){if(location.origin==="undefined"){location.origin=location.protocol+"//"+location.host}return location.origin}function stringToBlob(b){var a;if(pattern_xml.test(b)){a=new Blob([b],{type:"text/xml"})}else{if(pattern_turtle.test(b)){a=new Blob([b],{type:"text/turtle"})}else{if(pattern_json_ld.test(b)){a=new Blob([b],{type:"application/ld+json"})}else{if(pattern_n3.test(b)){a=new Blob([b],{type:"application/n-triples"})}}}}return a}function callWebService(c,g,h){var d="http://"+serverhost+":"+serverport+"/getfile?",f="url="+encodeURIComponent(c),a=d+f,e=null,b;if(window.XMLHttpRequest){e=new XMLHttpRequest()}else{if(window.ActiveXObject){e=new ActiveXObject("Microsoft.XMLHTTP")}}e.onreadystatechange=function(){if(this.readyState===4&&this.status!==200){alert(a+" was not loaded in the triple store: "+this.readyState+" HTTP"+this.status+" "+this.statusText)}else{if(this.readyState===4&&this.status===200){b=stringToBlob(this.responseText);uploadFile(b,g,h)}}};e.open("GET",a,false);e.send()}function registerGraph(f){var c="http://"+serverhost+":"+serverport+"/registergraph?",e="graphid="+encodeURIComponent(f),a=c+e,d=null,b="";if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLHTTP")}}d.onreadystatechange=function(){if(this.readyState===4&&this.status!==200){alert(a+" was not reachable: "+this.readyState+" HTTP"+this.status+" "+this.statusText)}else{if(this.readyState===4&&this.status===200){b=this.responseText}}};d.open("GET",a,true);d.send()}function onForm1Submit(f){var d,j,g,c,b,a;if(validateForm1()){try{d=document.getElementById("metadatafile");j=document.getElementById("tab1endpoint").value;g=getGraphFromCookie();deleteGraph(g,j);for(c=0;c<d.files.length;c=c+1){b=d.files[c];if(b.name.endsWith("json")||b.name.endsWith("jsonld")){a=new Blob([b],{type:"application/ld+json"});uploadFile(a,g,j)}else{uploadFile(b,g,j)}}f.action=j+"/query";return true}catch(h){alert("Error: "+h.message);return false}return true}return false}function onForm2Submit(b){var a,f,c;if(validateForm2()){try{a=document.getElementById("address").value;f=document.getElementById("tab2endpoint").value;c=getGraphFromCookie();deleteGraph(c,f);callWebService(a,c,f);b.action=f+"/query";return true}catch(d){alert("Error: "+d.message);return false}return true}return false}function onForm3Submit(b){var g,f,c,a;if(validateForm3()){try{g=filterInput(editor.getValue());f=document.getElementById("tab3endpoint").value;c=getGraphFromCookie();deleteGraph(c,f);a=stringToBlob(g);uploadFile(a,c,f);b.action=f+"/query";return true}catch(d){alert("Error: "+d.message);return false}return true}return false}function updateEditor(){var a=editor.getValue();if(pattern_xml.test(a)){editor.setOption("mode","xml")}else{if(pattern_turtle.test(a)){editor.setOption("mode","text/turtle")}else{if(pattern_json_ld.test(a)){editor.setOption("mode","application/ld+json")}else{if(pattern_n3.test(a)){editor.setOption("mode","text/n-triples")}}}}}function toggle(b,d){var a=$(b+" img.toggleicon"),c=$(b).next();c.slideToggle(300,function(){if(c.is(":visible")){a.attr("src","./images/arrow-open.png");d.refresh()}else{a.attr("src","./images/arrow-closed.png")}})}$(document).ready(function(){var c=getBaseURL()+"/"+sparqlEndpoint,a=encodeURI("http://cpsv-ap/"+new Date().getTime()),b;$("#tab1endpoint").val(c);$("#tab2endpoint").val(c);$("#tab3endpoint").val(c);$("#logobanner").attr("href","/"+homepage);if(getGraphFromCookie()===undefined){setCookie(a,servercookiedays);registerGraph(a)}getQuery(queryfile,getGraphFromCookie());editortab1=CodeMirror.fromTextArea(document.getElementById("tab1validationquery"),{mode:"turtle",lineNumbers:true});editortab2=CodeMirror.fromTextArea(document.getElementById("tab2validationquery"),{mode:"turtle",lineNumbers:true});editor=CodeMirror.fromTextArea(document.getElementById("directinput"),{mode:"turtle",lineNumbers:true,extraKeys:{F11:function(d){d.setOption("fullScreen",!d.getOption("fullScreen"))},Esc:function(d){if(d.getOption("fullScreen")){d.setOption("fullScreen",false)}}}});editortab3=CodeMirror.fromTextArea(document.getElementById("tab3validationquery"),{mode:"turtle",lineNumbers:true});$("#tabs").tabs();$("#tab1options div.more").click(function(){toggle("#tab1options div.more",editortab1)});$("#tab2options div.more").click(function(){toggle("#tab2options div.more",editortab2)});$("#tab3options div.more").click(function(){toggle("#tab3options div.more",editortab3)});$("#loadsample1").click(function(){loadFile(samplettlfile)});$("#loadsample2").click(function(){loadFile(samplerdffile)});$("#loadsample3").click(function(){loadFile(samplentfile)});$("#loadsample4").click(function(){loadFile(samplejsonldfile)});editortab1.on("change",function(){validateQuery(editortab1,"#editortab1error","SPARQL query")});editortab2.on("change",function(){validateQuery(editortab2,"#editortab2error","SPARQL query")});editor.on("change",function(){validateQuery(editor,"#editorerror","direct RDF input");clearTimeout(b);b=setTimeout(updateEditor(),400)});editortab3.on("change",function(){validateQuery(editortab3,"#editortab3error","SPARQL query")})});